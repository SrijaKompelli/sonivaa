{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\SRIJA K\\\\OneDrive\\\\Desktop\\\\SONIVA\\\\soniva_web\\\\client\\\\src\\\\components\\\\Search.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ActionMenu = ({\n  track,\n  onAddFavorite,\n  onAddDiary,\n  onAddToPlaylist\n}) => {\n  _s();\n  const [isOpen, setIsOpen] = useState(false);\n  const menuRef = useRef(null);\n  useEffect(() => {\n    const handleClickOutside = event => {\n      if (menuRef.current && !menuRef.current.contains(event.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"action-menu\",\n    ref: menuRef,\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"three-dots\",\n      onClick: () => setIsOpen(!isOpen),\n      children: \"\\u22EF\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 20,\n      columnNumber: 7\n    }, this), isOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"menu-dropdown\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          onAddFavorite(track);\n          setIsOpen(false);\n        },\n        children: \"\\u2764 Add to Favorites\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 23,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          onAddDiary(track);\n          setIsOpen(false);\n        },\n        children: \"\\uD83D\\uDCDD Add Diary Note\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 24,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          onAddToPlaylist(track);\n          setIsOpen(false);\n        },\n        children: \"\\u2795 Add to Playlist\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 25,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 19,\n    columnNumber: 5\n  }, this);\n};\n_s(ActionMenu, \"yIsVPXmGJnWJAXf4YKobPzEQ+oo=\");\n_c = ActionMenu;\nexport default function Search() {\n  _s2();\n  const [q, setQ] = useState('');\n  const [tracks, setTracks] = useState([]);\n  const [moodFilterState, setMoodFilterState] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [allTracks, setAllTracks] = useState([]);\n  const [playingTrack, setPlayingTrack] = useState(null);\n  const audioRef = useRef(null);\n  useEffect(() => {\n    loadTracks();\n  }, []);\n  const loadTracks = async () => {\n    try {\n      const {\n        data\n      } = await api.get('/tracks');\n      // Normalize moods: some responses use `mood` (singular) while saved tracks use `moods` array\n      const normalized = (data || []).map(t => ({\n        ...t,\n        moods: Array.isArray(t.moods) ? t.moods : Array.isArray(t.mood) ? t.mood : t.mood ? [t.mood] : []\n      }));\n      setTracks(normalized);\n      setAllTracks(normalized);\n      setLoading(false);\n    } catch (err) {\n      console.error('Failed to load tracks:', err);\n      setLoading(false);\n    }\n  };\n\n  // When a mood filter is selected, fetch saved tracks from server that match the mood\n  useEffect(() => {\n    const fetchByMood = async () => {\n      if (!moodFilterState) {\n        // restore previously loaded tracks\n        setTracks(allTracks);\n        return;\n      }\n      try {\n        const {\n          data\n        } = await api.get('/tracks', {\n          params: {\n            mood: moodFilterState\n          }\n        });\n        const normalized = (data || []).map(t => ({\n          ...t,\n          moods: Array.isArray(t.moods) ? t.moods : Array.isArray(t.mood) ? t.mood : t.mood ? [t.mood] : [],\n          hasPreview: !!t.url\n        }));\n        setTracks(normalized);\n      } catch (err) {\n        console.error('Failed to fetch tracks by mood:', err);\n      }\n    };\n    fetchByMood();\n  }, [moodFilterState]);\n  const search = async e => {\n    e === null || e === void 0 ? void 0 : e.preventDefault();\n    try {\n      const {\n        data\n      } = await api.get('/tracks/search', {\n        params: {\n          q\n        }\n      });\n      setTracks(data);\n    } catch (err) {\n      console.error('Search failed:', err);\n    }\n  };\n  const save = async track => {\n    try {\n      await api.post('/tracks', track);\n      alert('Added to your library!');\n    } catch (err) {\n      alert('Failed to add to library');\n    }\n  };\n  const addFavorite = async track => {\n    try {\n      const payload = track._id ? {\n        trackId: track._id\n      } : {\n        url: track.url,\n        title: track.title,\n        artist: track.artist,\n        genre: track.genre,\n        coverImage: track.coverImage\n      };\n      await api.post('/users/favorites', payload);\n      alert('Added to favorites');\n    } catch (err) {\n      var _err$response, _err$response$data;\n      alert(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Failed to add favorite');\n    }\n  };\n  const addDiary = async track => {\n    try {\n      const mood = prompt('Enter mood (happy, sad, romantic, energetic, peaceful, nostalgic, party):');\n      if (!mood) return;\n      const notes = prompt('Optional notes:');\n      let trackId = track._id || track.id;\n      if (!trackId) {\n        // ensure track exists in DB by adding to favorites (creates the track) and get id\n        const favResp = await api.post('/users/favorites', {\n          url: track.url,\n          title: track.title,\n          artist: track.artist,\n          genre: track.genre,\n          coverImage: track.coverImage\n        });\n        trackId = favResp.data.trackId;\n      }\n      const response = await api.post('/diary', {\n        track: trackId,\n        mood,\n        text: notes\n      });\n      alert('Diary entry added');\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      console.error('Diary error:', err);\n      const errorMessage = ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Failed to add diary entry';\n      alert(errorMessage);\n    }\n  };\n  const addToPlaylist = async track => {\n    try {\n      const {\n        data: lists\n      } = await api.get('/playlists/me');\n      if (!lists || lists.length === 0) {\n        if (!confirm('No playlists found. Create one now?')) return;\n        const title = prompt('Playlist title:');\n        if (!title) return;\n        const created = await api.post('/playlists', {\n          title,\n          description: '',\n          moodTags: []\n        });\n        lists.push(created.data || created);\n      }\n      const listNames = lists.map((l, i) => `${i + 1}. ${l.title}`).join('\\n');\n      const choice = prompt('Choose playlist number:\\n' + listNames);\n      const idx = parseInt(choice || '', 10) - 1;\n      if (isNaN(idx) || idx < 0 || idx >= lists.length) return alert('Invalid choice');\n      const playlist = lists[idx];\n      // append track id (ensure track exists in DB)\n      let trackId = track._id || track.id;\n      if (!trackId) {\n        const favResp = await api.post('/users/favorites', {\n          url: track.url,\n          title: track.title,\n          artist: track.artist,\n          genre: track.genre,\n          coverImage: track.coverImage\n        });\n        trackId = favResp.data.trackId;\n      }\n      const updatedTracks = Array.isArray(playlist.tracks) ? [...playlist.tracks.map(t => t._id || t), trackId] : [trackId];\n      await api.put(`/playlists/${playlist._id}`, {\n        tracks: updatedTracks\n      });\n      alert('Track added to playlist');\n    } catch (err) {\n      console.error(err);\n      alert('Failed to add to playlist');\n    }\n  };\n  const togglePlay = async track => {\n    if (playingTrack === track.url) {\n      audioRef.current.pause();\n      setPlayingTrack(null);\n    } else {\n      if (audioRef.current) {\n        audioRef.current.pause();\n      }\n      // Only play tracks that have previews\n      if (track.hasPreview) {\n        console.log('Setting audio src to preview URL:', track.url);\n        audioRef.current.src = track.url;\n        try {\n          await audioRef.current.play();\n          setPlayingTrack(track.url);\n        } catch (err) {\n          console.error('Playback failed:', err);\n          alert('Unable to play this track. Preview may not be available.');\n        }\n      } else {\n        // Don't play tracks without previews - just show message\n        alert('This track preview is not available for playback.');\n      }\n    }\n  };\n  const filteredTracks = tracks.map(t => ({\n    ...t,\n    moods: Array.isArray(t.moods) ? t.moods : t.mood ? [t.mood] : []\n  })).filter(track => {\n    // base: only show tracks with preview when no text query and no mood filter\n    if (!q && !moodFilterState && !track.hasPreview) return false;\n    // text query filters title/artist/genre\n    if (q) {\n      const ql = q.toLowerCase();\n      if (track.title.toLowerCase().includes(ql) || track.artist.toLowerCase().includes(ql) || (track.genre || '').toLowerCase().includes(ql)) return true;\n      // if mood filter is set as text query fallback, still allow mood matching\n    }\n    // mood filter (explicit tag click)\n    if (moodFilterState) {\n      const mf = moodFilterState.toLowerCase();\n      if (Array.isArray(track.moods) && track.moods.map(m => m.toLowerCase()).includes(mf)) return true;\n      // also check singular `mood` prop if present\n      if (track.mood && (Array.isArray(track.mood) ? track.mood.map(m => m.toLowerCase()).includes(mf) : String(track.mood).toLowerCase() === mf)) return true;\n      return false;\n    }\n    // if no filters, include track if has preview\n    if (!q && !moodFilterState) return track.hasPreview;\n    // otherwise include (fallback)\n    return true;\n  });\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search-box\",\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 12\n    }, this);\n  }\n  const moodFilter = m => {\n    // set explicit mood filter; clicking the same mood toggles it off\n    if (!m) {\n      setMoodFilterState('');\n      setQ('');\n      return;\n    }\n    if (moodFilterState && moodFilterState.toLowerCase() === m.toLowerCase()) {\n      setMoodFilterState('');\n      setQ('');\n    } else {\n      setMoodFilterState(m);\n      setQ('');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search-box\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Discover Music\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 8,\n          marginBottom: 12\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => moodFilter('happy'),\n          children: \"Happy\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => moodFilter('sad'),\n          children: \"Sad\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => moodFilter('study'),\n          children: \"Study\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => moodFilter('devotional'),\n          children: \"Devotional\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => moodFilter('love'),\n          children: \"Love\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: search,\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          value: q,\n          onChange: e => setQ(e.target.value),\n          placeholder: \"Search by title, artist, or genre\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-grid\",\n      children: filteredTracks.map(track => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"track-image-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: track.coverImage,\n            alt: track.title,\n            className: \"track-image\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 15\n          }, this), track.hasPreview && /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"play-button\",\n            onClick: () => togglePlay(track),\n            children: playingTrack === track.url ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"track-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"track-title\",\n            children: track.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"track-artist\",\n            children: track.artist\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"track-genre\",\n            children: [track.genre, \" \\u2022 \", track.duration]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginTop: 8\n            },\n            children: (track.moods || []).slice(0, 5).map((m, idx) => /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => moodFilter(m),\n              style: {\n                marginRight: 6,\n                marginBottom: 6,\n                padding: '4px 8px',\n                borderRadius: 12,\n                border: '1px solid rgba(0,0,0,0.12)',\n                background: moodFilterState && moodFilterState.toLowerCase() === String(m).toLowerCase() ? '#dfefff' : 'white',\n                cursor: 'pointer',\n                fontSize: '0.85rem'\n              },\n              children: m\n            }, idx, false, {\n              fileName: _jsxFileName,\n              lineNumber: 277,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"track-actions\",\n            children: /*#__PURE__*/_jsxDEV(ActionMenu, {\n              track: track,\n              onAddFavorite: addFavorite,\n              onAddDiary: addDiary,\n              onAddToPlaylist: addToPlaylist\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 13\n        }, this)]\n      }, track.url, true, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: audioRef,\n      onEnded: () => setPlayingTrack(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 236,\n    columnNumber: 5\n  }, this);\n}\n_s2(Search, \"OFgxToGrMDi8Sty8YpCfEdtnn/Q=\");\n_c2 = Search;\nvar _c, _c2;\n$RefreshReg$(_c, \"ActionMenu\");\n$RefreshReg$(_c2, \"Search\");","map":{"version":3,"names":["React","useState","useEffect","useRef","api","jsxDEV","_jsxDEV","ActionMenu","track","onAddFavorite","onAddDiary","onAddToPlaylist","_s","isOpen","setIsOpen","menuRef","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","className","ref","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_c","Search","_s2","q","setQ","tracks","setTracks","moodFilterState","setMoodFilterState","loading","setLoading","allTracks","setAllTracks","playingTrack","setPlayingTrack","audioRef","loadTracks","data","get","normalized","map","t","moods","Array","isArray","mood","err","console","error","fetchByMood","params","hasPreview","url","search","e","preventDefault","save","post","alert","addFavorite","payload","_id","trackId","title","artist","genre","coverImage","_err$response","_err$response$data","response","message","addDiary","prompt","notes","id","favResp","text","_err$response2","_err$response2$data","errorMessage","addToPlaylist","lists","length","confirm","created","description","moodTags","push","listNames","l","i","join","choice","idx","parseInt","isNaN","playlist","updatedTracks","put","togglePlay","pause","log","src","play","filteredTracks","filter","ql","toLowerCase","includes","mf","m","String","moodFilter","style","display","gap","marginBottom","onSubmit","value","onChange","placeholder","alt","duration","marginTop","slice","marginRight","padding","borderRadius","border","background","cursor","fontSize","onEnded","_c2","$RefreshReg$"],"sources":["C:/Users/SRIJA K/OneDrive/Desktop/SONIVA/soniva_web/client/src/components/Search.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport api from '../services/api';\r\n\r\nconst ActionMenu = ({ track, onAddFavorite, onAddDiary, onAddToPlaylist }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const menuRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"action-menu\" ref={menuRef}>\r\n      <button className=\"three-dots\" onClick={() => setIsOpen(!isOpen)}>‚ãØ</button>\r\n      {isOpen && (\r\n        <div className=\"menu-dropdown\">\r\n          <button onClick={() => { onAddFavorite(track); setIsOpen(false); }}>‚ù§ Add to Favorites</button>\r\n          <button onClick={() => { onAddDiary(track); setIsOpen(false); }}>üìù Add Diary Note</button>\r\n          <button onClick={() => { onAddToPlaylist(track); setIsOpen(false); }}>‚ûï Add to Playlist</button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function Search() {\r\n  const [q, setQ] = useState('');\r\n  const [tracks, setTracks] = useState([]);\r\n  const [moodFilterState, setMoodFilterState] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [allTracks, setAllTracks] = useState([]);\r\n  const [playingTrack, setPlayingTrack] = useState(null);\r\n  const audioRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    loadTracks();\r\n  }, []);\r\n\r\n  const loadTracks = async () => {\r\n    try {\r\n      const { data } = await api.get('/tracks');\r\n      // Normalize moods: some responses use `mood` (singular) while saved tracks use `moods` array\r\n      const normalized = (data || []).map(t => ({\r\n        ...t,\r\n        moods: Array.isArray(t.moods) ? t.moods : (Array.isArray(t.mood) ? t.mood : (t.mood ? [t.mood] : []))\r\n      }));\r\n      setTracks(normalized);\r\n      setAllTracks(normalized);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      console.error('Failed to load tracks:', err);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // When a mood filter is selected, fetch saved tracks from server that match the mood\r\n  useEffect(() => {\r\n    const fetchByMood = async () => {\r\n      if (!moodFilterState) {\r\n        // restore previously loaded tracks\r\n        setTracks(allTracks);\r\n        return;\r\n      }\r\n      try {\r\n        const { data } = await api.get('/tracks', { params: { mood: moodFilterState } });\r\n        const normalized = (data || []).map(t => ({\r\n          ...t,\r\n          moods: Array.isArray(t.moods) ? t.moods : (Array.isArray(t.mood) ? t.mood : (t.mood ? [t.mood] : [])),\r\n          hasPreview: !!t.url\r\n        }));\r\n        setTracks(normalized);\r\n      } catch (err) {\r\n        console.error('Failed to fetch tracks by mood:', err);\r\n      }\r\n    };\r\n    fetchByMood();\r\n  }, [moodFilterState]);\r\n\r\n  const search = async (e) => {\r\n    e?.preventDefault();\r\n    try {\r\n      const { data } = await api.get('/tracks/search', { params: { q } });\r\n      setTracks(data);\r\n    } catch (err) {\r\n      console.error('Search failed:', err);\r\n    }\r\n  };\r\n\r\n  const save = async (track) => {\r\n    try {\r\n      await api.post('/tracks', track);\r\n      alert('Added to your library!');\r\n    } catch (err) {\r\n      alert('Failed to add to library');\r\n    }\r\n  };\r\n\r\n  const addFavorite = async (track) => {\r\n    try {\r\n      const payload = track._id ? { trackId: track._id } : { url: track.url, title: track.title, artist: track.artist, genre: track.genre, coverImage: track.coverImage };\r\n      await api.post('/users/favorites', payload);\r\n      alert('Added to favorites');\r\n    } catch (err) {\r\n      alert(err.response?.data?.message || 'Failed to add favorite');\r\n    }\r\n  };\r\n\r\n  const addDiary = async (track) => {\r\n    try {\r\n      const mood = prompt('Enter mood (happy, sad, romantic, energetic, peaceful, nostalgic, party):');\r\n      if (!mood) return;\r\n      const notes = prompt('Optional notes:');\r\n      let trackId = track._id || track.id;\r\n      if (!trackId) {\r\n        // ensure track exists in DB by adding to favorites (creates the track) and get id\r\n        const favResp = await api.post('/users/favorites', { url: track.url, title: track.title, artist: track.artist, genre: track.genre, coverImage: track.coverImage });\r\n        trackId = favResp.data.trackId;\r\n      }\r\n      const response = await api.post('/diary', { track: trackId, mood, text: notes });\r\n      alert('Diary entry added');\r\n    } catch (err) {\r\n      console.error('Diary error:', err);\r\n      const errorMessage = err.response?.data?.message || 'Failed to add diary entry';\r\n      alert(errorMessage);\r\n    }\r\n  };\r\n\r\n  const addToPlaylist = async (track) => {\r\n    try {\r\n      const { data: lists } = await api.get('/playlists/me');\r\n      if (!lists || lists.length === 0) {\r\n        if (!confirm('No playlists found. Create one now?')) return;\r\n        const title = prompt('Playlist title:');\r\n        if (!title) return;\r\n        const created = await api.post('/playlists', { title, description: '', moodTags: [] });\r\n        lists.push(created.data || created);\r\n      }\r\n      const listNames = lists.map((l, i) => `${i+1}. ${l.title}`).join('\\n');\r\n      const choice = prompt('Choose playlist number:\\n' + listNames);\r\n      const idx = parseInt(choice || '', 10) - 1;\r\n      if (isNaN(idx) || idx < 0 || idx >= lists.length) return alert('Invalid choice');\r\n      const playlist = lists[idx];\r\n      // append track id (ensure track exists in DB)\r\n      let trackId = track._id || track.id;\r\n      if (!trackId) {\r\n        const favResp = await api.post('/users/favorites', { url: track.url, title: track.title, artist: track.artist, genre: track.genre, coverImage: track.coverImage });\r\n        trackId = favResp.data.trackId;\r\n      }\r\n      const updatedTracks = Array.isArray(playlist.tracks) ? [...playlist.tracks.map(t=>t._id || t), trackId] : [trackId];\r\n      await api.put(`/playlists/${playlist._id}`, { tracks: updatedTracks });\r\n      alert('Track added to playlist');\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Failed to add to playlist');\r\n    }\r\n  };\r\n\r\n  const togglePlay = async (track) => {\r\n    if (playingTrack === track.url) {\r\n      audioRef.current.pause();\r\n      setPlayingTrack(null);\r\n    } else {\r\n      if (audioRef.current) {\r\n        audioRef.current.pause();\r\n      }\r\n      // Only play tracks that have previews\r\n      if (track.hasPreview) {\r\n        console.log('Setting audio src to preview URL:', track.url);\r\n        audioRef.current.src = track.url;\r\n        try {\r\n          await audioRef.current.play();\r\n          setPlayingTrack(track.url);\r\n        } catch (err) {\r\n          console.error('Playback failed:', err);\r\n          alert('Unable to play this track. Preview may not be available.');\r\n        }\r\n      } else {\r\n        // Don't play tracks without previews - just show message\r\n        alert('This track preview is not available for playback.');\r\n      }\r\n    }\r\n  };\r\n\r\n  const filteredTracks = tracks\r\n    .map(t => ({ ...t, moods: Array.isArray(t.moods) ? t.moods : (t.mood ? [t.mood] : []) }))\r\n    .filter(track => {\r\n      // base: only show tracks with preview when no text query and no mood filter\r\n      if (!q && !moodFilterState && !track.hasPreview) return false;\r\n      // text query filters title/artist/genre\r\n      if (q) {\r\n        const ql = q.toLowerCase();\r\n        if (\r\n          track.title.toLowerCase().includes(ql) ||\r\n          track.artist.toLowerCase().includes(ql) ||\r\n          (track.genre || '').toLowerCase().includes(ql)\r\n        ) return true;\r\n        // if mood filter is set as text query fallback, still allow mood matching\r\n      }\r\n      // mood filter (explicit tag click)\r\n      if (moodFilterState) {\r\n        const mf = moodFilterState.toLowerCase();\r\n        if (Array.isArray(track.moods) && track.moods.map(m=>m.toLowerCase()).includes(mf)) return true;\r\n        // also check singular `mood` prop if present\r\n        if (track.mood && (Array.isArray(track.mood) ? track.mood.map(m=>m.toLowerCase()).includes(mf) : String(track.mood).toLowerCase() === mf)) return true;\r\n        return false;\r\n      }\r\n      // if no filters, include track if has preview\r\n      if (!q && !moodFilterState) return track.hasPreview;\r\n      // otherwise include (fallback)\r\n      return true;\r\n    });\r\n\r\n  if (loading) {\r\n    return <div className=\"search-box\">Loading...</div>;\r\n  }\r\n\r\n  const moodFilter = (m) => {\r\n    // set explicit mood filter; clicking the same mood toggles it off\r\n    if (!m) { setMoodFilterState(''); setQ(''); return; }\r\n    if (moodFilterState && moodFilterState.toLowerCase() === m.toLowerCase()) {\r\n      setMoodFilterState('');\r\n      setQ('');\r\n    } else {\r\n      setMoodFilterState(m);\r\n      setQ('');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"search-box\">\r\n        <h2>Discover Music</h2>\r\n        <div style={{ display: 'flex', gap: 8, marginBottom: 12 }}>\r\n          <button onClick={() => moodFilter('happy')}>Happy</button>\r\n          <button onClick={() => moodFilter('sad')}>Sad</button>\r\n          <button onClick={() => moodFilter('study')}>Study</button>\r\n          <button onClick={() => moodFilter('devotional')}>Devotional</button>\r\n          <button onClick={() => moodFilter('love')}>Love</button>\r\n        </div>\r\n        <form onSubmit={search}>\r\n          <input \r\n            value={q} \r\n            onChange={e => setQ(e.target.value)}\r\n            placeholder=\"Search by title, artist, or genre\"\r\n          />\r\n        </form>\r\n      </div>\r\n      \r\n      <div className=\"track-grid\">\r\n        {filteredTracks.map(track => (\r\n          <div key={track.url} className=\"track-card\">\r\n            <div className=\"track-image-container\">\r\n              <img\r\n                src={track.coverImage}\r\n                alt={track.title}\r\n                className=\"track-image\"\r\n              />\r\n              {track.hasPreview && (\r\n                <button className=\"play-button\" onClick={() => togglePlay(track)}>\r\n                  {playingTrack === track.url ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}\r\n                </button>\r\n              )}\r\n            </div>\r\n            <div className=\"track-info\">\r\n              <h3 className=\"track-title\">{track.title}</h3>\r\n              <p className=\"track-artist\">{track.artist}</p>\r\n              <p className=\"track-genre\">{track.genre} ‚Ä¢ {track.duration}</p>\r\n                {/* Mood tags */}\r\n                <div style={{ marginTop: 8 }}>\r\n                  {(track.moods || []).slice(0,5).map((m, idx) => (\r\n                    <button\r\n                      key={idx}\r\n                      onClick={() => moodFilter(m)}\r\n                      style={{\r\n                        marginRight: 6,\r\n                        marginBottom: 6,\r\n                        padding: '4px 8px',\r\n                        borderRadius: 12,\r\n                        border: '1px solid rgba(0,0,0,0.12)',\r\n                        background: (moodFilterState && moodFilterState.toLowerCase() === String(m).toLowerCase()) ? '#dfefff' : 'white',\r\n                        cursor: 'pointer',\r\n                        fontSize: '0.85rem'\r\n                      }}\r\n                    >\r\n                      {m}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n                <div className=\"track-actions\">\r\n                <ActionMenu\r\n                  track={track}\r\n                  onAddFavorite={addFavorite}\r\n                  onAddDiary={addDiary}\r\n                  onAddToPlaylist={addToPlaylist}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <audio ref={audioRef} onEnded={() => setPlayingTrack(null)} />\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}